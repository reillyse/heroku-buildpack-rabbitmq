#!/usr/bin/env bash

set -eo pipefail

indent() {
  sed -u 's/^/       /'
}

# Usage: $ set-env key value
set-env() {
  echo "export $1=$2" >> $PROFILE_PATH
}

#!/bin/sh


export RABBITMQ_CONF_ENV_FILE=/tmp/
mkdir /tmp/data-base
export RABBITMQ_MNESIA_DIR=/tmp/data-base
export PATH=./app/.apt/usr/lib/erlang/erts-9.2/bin:$PATH
export PATH=$PATH:/app/.apt/usr/lib/erlang/erts-9.2/bin
export PATH=$PATH:/app/.apt/usr/lib/rabbitmq/bin
export BINDIR="/app/.apt/usr/lib/erlang/erts-9.2/bin"
export RABBITMQ_LOG_BASE=/app/.apt
export RABBITMQ_PLUGINS_EXPAND_DIR=/app/.apt
sed  's|/usr/lib/erlang|/app/.apt/usr/lib/erlang|g'./app/.apt/usr/lib/erlang/erts-9.2/bin/erl
wget https://github.com/rabbitmq/rabbitmq-delayed-message-exchange/releases/download/v3.8.0/rabbitmq_delayed_message_exchange-3.8.0.ez -P ./app/.apt/usr/lib/rabbitmq/lib/rabbitmq_server-3.6.10/plugins

rabbitmq-plugins enable rabbitmq_delayed_message_exchange
echo "Done" | indent
